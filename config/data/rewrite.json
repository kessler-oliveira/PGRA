[{"name":"Subconsulta acoplada na lista de parâmetros","description":"Refatora subconsultas acopladas que estejam na lista de parâmetros de retorno, apenas para o primeiro nível.","query":{"text":"SELECT \"rw_tmp_1\".\"id\" FROM \"teste\" x LEFT JOIN (SELECT \"y\".\"id\", \"y\".\"id\" AS rw_id FROM \"teste2\" y) rw_tmp_1 ON \"x\".\"id\" = \"rw_tmp_1\".\"rw_id\"","tree":[{"SelectStmt":{"targetList":[{"ResTarget":{"val":{"ColumnRef":{"fields":[{"String":{"str":"rw_tmp_1"}},{"String":{"str":"id"}}],"location":7}},"location":7}}],"fromClause":[{"JoinExpr":{"jointype":1,"larg":{"RangeVar":{"relname":"teste","inhOpt":2,"relpersistence":"p","alias":{"Alias":{"aliasname":"x"}},"location":28}},"rarg":{"RangeSubselect":{"subquery":{"SelectStmt":{"targetList":[{"ResTarget":{"val":{"ColumnRef":{"fields":[{"String":{"str":"y"}},{"String":{"str":"id"}}],"location":56}},"location":56}},{"ResTarget":{"name":"rw_id","val":{"ColumnRef":{"fields":[{"String":{"str":"y"}},{"String":{"str":"id"}}],"location":66}},"location":66}}],"fromClause":[{"RangeVar":{"relname":"teste2","inhOpt":2,"relpersistence":"p","alias":{"Alias":{"aliasname":"y"}},"location":89}}],"op":0}},"alias":{"Alias":{"aliasname":"rw_tmp_1"}}}},"quals":{"A_Expr":{"kind":0,"name":[{"String":{"str":"="}}],"lexpr":{"ColumnRef":{"fields":[{"String":{"str":"x"}},{"String":{"str":"id"}}],"location":113}},"rexpr":{"ColumnRef":{"fields":[{"String":{"str":"rw_tmp_1"}},{"String":{"str":"rw_id"}}],"location":124}},"location":122}}}}],"op":0}}],"explain":[{"Plan":{"Node Type":"Hash Join","Join Type":"Left","Startup Cost":17.2,"Total Cost":201.88,"Plan Rows":4080,"Plan Width":4,"Hash Cond":"(x.id = y.id)","Plans":[{"Node Type":"Seq Scan","Parent Relationship":"Outer","Relation Name":"teste","Alias":"x","Startup Cost":0.0,"Total Cost":35.5,"Plan Rows":2550,"Plan Width":4},{"Node Type":"Hash","Parent Relationship":"Inner","Startup Cost":13.2,"Total Cost":13.2,"Plan Rows":320,"Plan Width":4,"Plans":[{"Node Type":"Seq Scan","Parent Relationship":"Outer","Relation Name":"teste2","Alias":"y","Startup Cost":0.0,"Total Cost":13.2,"Plan Rows":320,"Plan Width":4}]}]}}],"work":true,"cost":201.88,"count":2,"type":"SELECT","tables":[{"name":"teste","schema":"public","alias":"x","columns":[{"name":"id","is_nullable":"YES","data_type":"integer"}]}],"select":[{"value":"id","alias":null,"table":null,"alias_table":"rw_tmp_1","schema":null,"data_type":null,"type":"column"}],"where":null,"subquerys":[{"type":"from","alias":"rw_tmp_1","query":[{"text":"SELECT \"y\".\"id\", \"y\".\"id\" AS rw_id FROM \"teste2\" y","tree":[{"SelectStmt":{"targetList":[{"ResTarget":{"val":{"ColumnRef":{"fields":[{"String":{"str":"y"}},{"String":{"str":"id"}}],"location":7}},"location":7}},{"ResTarget":{"name":"rw_id","val":{"ColumnRef":{"fields":[{"String":{"str":"y"}},{"String":{"str":"id"}}],"location":17}},"location":17}}],"fromClause":[{"RangeVar":{"relname":"teste2","inhOpt":2,"relpersistence":"p","alias":{"Alias":{"aliasname":"y"}},"location":40}}],"op":0}}],"explain":[{"Plan":{"Node Type":"Seq Scan","Relation Name":"teste2","Alias":"y","Startup Cost":0.0,"Total Cost":13.2,"Plan Rows":320,"Plan Width":4}}],"work":true,"cost":13.2,"count":1,"type":"SELECT","tables":[{"name":"teste2","schema":"public","alias":"y","columns":[{"name":"id","is_nullable":"YES","data_type":"integer"},{"name":"nome","is_nullable":"YES","data_type":"character varying"}]}],"select":[{"value":"id","alias":null,"table":"teste2","alias_table":"y","schema":"public","data_type":"integer","type":"column"},{"value":"id","alias":"rw_id","table":"teste2","alias_table":"y","schema":"public","data_type":"integer","type":"column"}],"where":null,"subquerys":null}]}]},"performance":99.44,"reescrever":false,"rank":1},{"name":"Original","description":"-","query":{"text":"SELECT (SELECT Y.ID FROM TESTE2 Y WHERE X.ID = Y.ID) FROM TESTE X","tree":[{"SelectStmt":{"targetList":[{"ResTarget":{"val":{"SubLink":{"subLinkType":4,"subselect":{"SelectStmt":{"targetList":[{"ResTarget":{"val":{"ColumnRef":{"fields":[{"String":{"str":"y"}},{"String":{"str":"id"}}],"location":15}},"location":15}}],"fromClause":[{"RangeVar":{"relname":"teste2","inhOpt":2,"relpersistence":"p","alias":{"Alias":{"aliasname":"y"}},"location":25}}],"whereClause":{"A_Expr":{"kind":0,"name":[{"String":{"str":"="}}],"lexpr":{"ColumnRef":{"fields":[{"String":{"str":"x"}},{"String":{"str":"id"}}],"location":40}},"rexpr":{"ColumnRef":{"fields":[{"String":{"str":"y"}},{"String":{"str":"id"}}],"location":47}},"location":45}},"op":0}},"location":7}},"location":7}}],"fromClause":[{"RangeVar":{"relname":"teste","inhOpt":2,"relpersistence":"p","alias":{"Alias":{"aliasname":"x"}},"location":58}}],"op":0}}],"explain":[{"Plan":{"Node Type":"Seq Scan","Relation Name":"teste","Alias":"x","Startup Cost":0.0,"Total Cost":35735.5,"Plan Rows":2550,"Plan Width":4,"Plans":[{"Node Type":"Seq Scan","Parent Relationship":"SubPlan","Subplan Name":"SubPlan 1","Relation Name":"teste2","Alias":"y","Startup Cost":0.0,"Total Cost":14.0,"Plan Rows":2,"Plan Width":4,"Filter":"(x.id = id)"}]}}],"work":true,"cost":35735.5,"count":2,"type":"SELECT","tables":[{"name":"teste","schema":"public","alias":"x","columns":[{"name":"id","is_nullable":"YES","data_type":"integer"}]}],"select":[{"value":"SELECT \"y\".\"id\" FROM \"teste2\" y WHERE \"x\".\"id\" = \"y\".\"id\"","alias":null,"table":null,"alias_table":null,"schema":null,"data_type":null,"type":"subquery"}],"where":null,"subquerys":[{"type":"column","alias":null,"query":[{"text":"SELECT \"y\".\"id\" FROM \"teste2\" y WHERE \"x\".\"id\" = \"y\".\"id\"","tree":[{"SelectStmt":{"targetList":[{"ResTarget":{"val":{"ColumnRef":{"fields":[{"String":{"str":"y"}},{"String":{"str":"id"}}],"location":7}},"location":7}}],"fromClause":[{"RangeVar":{"relname":"teste2","inhOpt":2,"relpersistence":"p","alias":{"Alias":{"aliasname":"y"}},"location":21}}],"whereClause":{"A_Expr":{"kind":0,"name":[{"String":{"str":"="}}],"lexpr":{"ColumnRef":{"fields":[{"String":{"str":"x"}},{"String":{"str":"id"}}],"location":38}},"rexpr":{"ColumnRef":{"fields":[{"String":{"str":"y"}},{"String":{"str":"id"}}],"location":49}},"location":47}},"op":0}}],"explain":null,"work":false,"cost":null,"count":null,"type":"SELECT","tables":[{"name":"teste2","schema":"public","alias":"y","columns":[{"name":"id","is_nullable":"YES","data_type":"integer"},{"name":"nome","is_nullable":"YES","data_type":"character varying"}]}],"select":[{"value":"id","alias":null,"table":"teste2","alias_table":"y","schema":"public","data_type":"integer","type":"column"}],"where":{"operator":"=","left_expr":{"value":"id","table":null,"alias_table":"x","schema":null,"data_type":null,"type":"column"},"right_expr":{"value":"id","table":"teste2","alias_table":"y","schema":"public","data_type":"integer","type":"column"}},"subquerys":null}]}]},"performance":0,"reescrever":false,"rank":2}]